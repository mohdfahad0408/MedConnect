<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Dashboard - Care</title>
    <style>
        :root { --primary-color:#0ea5e9; --primary-dark:#0284c7; --primary-light:#bae6fd; --success-color:#10b981; --warning-color:#f59e0b; --danger-color:#ef4444; --text-primary:#1f2937; --text-secondary:#6b7280; --text-tertiary:#9ca3af; --bg-primary:#ffffff; --bg-secondary:#f9fafb; --bg-tertiary:#f5f7fb; --border-color:#e5e7eb; --shadow-sm:0 1px 3px rgba(0,0,0,0.05); --shadow-md:0 4px 12px rgba(0,0,0,0.08); --shadow-lg:0 10px 30px rgba(0,0,0,0.12); --sidebar-width:280px; --sidebar-collapsed:70px; --transition-speed:0.3s; }
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background:var(--bg-tertiary);color:var(--text-primary);line-height:1.6;overflow-x:hidden}
        .sidebar{width:var(--sidebar-width);background:#1a1d2e;color:white;padding:30px 0;position:fixed;height:100vh;overflow-y:auto;z-index:1000;transition:transform var(--transition-speed) ease,width var(--transition-speed) ease}
        .logo{padding:0 30px;margin-bottom:50px;display:flex;align-items:center;gap:12px;font-size:1.5em;font-weight:600}
        .nav-section{margin-bottom:40px}
        .nav-label{padding:0 30px;font-size:.75em;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:1px;margin-bottom:15px}
        .nav-item{padding:14px 30px;display:flex;align-items:center;gap:15px;color:var(--text-tertiary);cursor:pointer;transition:all .2s ease;font-size:.95em;text-decoration:none}
        .nav-item:hover{background:rgba(14,165,233,.1);color:#fff}
        .nav-item.active{background:rgba(14,165,233,.15);color:#fff;border-left:3px solid var(--primary-color)}
        .main-content{margin-left:var(--sidebar-width);padding:30px 40px;transition:margin-left var(--transition-speed) ease;min-height:100vh}
        .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:35px;flex-wrap:wrap;gap:20px}
        .user-profile{display:flex;align-items:center;gap:12px;padding:8px 15px;border-radius:12px}
        .user-avatar{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,var(--primary-color),var(--primary-light))}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;margin-bottom:30px}
        .stat-card{background:var(--bg-primary);padding:25px;border-radius:16px;box-shadow:var(--shadow-sm);transition:all var(--transition-speed) ease}
        .stat-card:hover{transform:translateY(-5px);box-shadow:var(--shadow-lg);border:1px solid var(--primary-color)}
        .stat-header{display:flex;justify-content:space-between;align-items:flex-start;gap:15px}
        .stat-icon{width:50px;height:50px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.5em}
        .stat-icon.blue{background:#dbeafe;color:#0284c7}.stat-icon.green{background:#d1fae5;color:var(--success-color)}.stat-icon.purple{background:#f3e8ff;color:#7c3aed}.stat-icon.orange{background:#ffedd5;color:#ea580c}
        .stat-label{font-size:.85em;color:var(--text-secondary);margin-bottom:8px}
        .stat-value{font-size:1.8em;font-weight:700;color:var(--text-primary);margin-bottom:8px}
        .content-grid{display:grid;grid-template-columns:1fr;gap:25px;margin-bottom:30px}
        @media(min-width:1024px){.content-grid{grid-template-columns:1.5fr 1fr}}
        .card{background:var(--bg-primary);border-radius:16px;padding:25px;box-shadow:var(--shadow-sm)}
        .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px}
        .card-title{font-size:1.3em;font-weight:600}
        .appointment-list{display:flex;flex-direction:column;gap:15px}
        .appointment-item{display:flex;align-items:center;gap:15px;padding:15px;background:var(--bg-secondary);border-radius:12px;border-left:4px solid var(--primary-color);flex-wrap:wrap}
        .appointment-time{background:var(--primary-color);color:#fff;padding:10px 15px;border-radius:10px;font-weight:600;font-size:.9em;text-align:center;min-width:80px}
        .appointment-details{flex:1;min-width:150px}
        .appointment-status{padding:6px 14px;border-radius:20px;font-size:.8em;font-weight:600;white-space:nowrap}
        .status-confirmed{background:#d1fae5;color:var(--success-color)}.status-pending{background:#fef3c7;color:var(--warning-color)}.status-completed{background:#e0e7ff;color:#4f46e5}
        .view-all{color:var(--primary-color);text-decoration:none}
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="logo"><span class="logo-icon">üè•</span><span>Care</span></div>
        <div class="nav-section">
            <div class="nav-label">Main Menu</div>
            <a class="nav-item active" href="dashboard.html"><span class="nav-icon">üìä</span><span>Dashboard</span></a>
            <a class="nav-item" href="appointments.html"><span class="nav-icon">üìÖ</span><span>Appointments</span></a>
            <a class="nav-item" href="patients.html"><span class="nav-icon">üë•</span><span>My Patients</span></a>
            <a class="nav-item" href="reviews.html"><span class="nav-icon">‚≠ê</span><span>Reviews</span></a>
            <a class="nav-item" href="earnings.html"><span class="nav-icon">üí∞</span><span>Earnings</span></a>
            <a class="nav-item" href="analytics.html"><span class="nav-icon">üìà</span><span>Analytics</span></a>
            <a class="nav-item" href="profile.html"><span class="nav-icon">üë§</span><span>My Profile</span></a>
        </div>
    </div>
    <div class="main-content">
        <div class="header">
            <div class="header-left">
                <h1>Welcome Back, Doctor!</h1>
                <p>Here's what's happening with your practice today</p>
            </div>
            <div class="user-profile">
                <div class="user-info">
                    <div class="user-name">Doctor</div>
                    <div class="user-role">Administrator</div>
                </div>
                <div class="user-avatar"></div>
            </div>
        </div>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div>
                        <div class="stat-label">Today's Appointments</div>
                        <div id="stat-today-appointments" class="stat-value">0</div>
                    </div>
                    <div class="stat-icon blue">üìÖ</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div>
                        <div class="stat-label">Total Patients</div>
                        <div id="stat-total-patients" class="stat-value">0</div>
                    </div>
                    <div class="stat-icon green">üë•</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div>
                        <div class="stat-label">Upcoming Appointments</div>
                        <div id="stat-upcoming" class="stat-value">0</div>
                    </div>
                    <div class="stat-icon orange">‚è≥</div>
                </div>
            </div>
        </div>
        <div class="content-grid">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Today's Appointments</h2>
                    <a href="appointments.html" class="view-all">View All ‚Üí</a>
                </div>
                <div id="today-list" class="appointment-list"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Quick Links</h2>
                </div>
                <div>
                    <p><a class="view-all" href="patients.html">Manage Patients ‚Üí</a></p>
                    <p><a class="view-all" href="appointments.html">Manage Appointments ‚Üí</a></p>
                </div>
            </div>
        </div>
    </div>
    <script type="module">
        // Load appointments from Firestore and render dashboard
    import { db } from '../firebase.js';
        import { collection, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js';

        function formatDateIso(dateStr){ return dateStr; }

        const todayIso = new Date().toISOString().slice(0,10);

        const apptsCol = collection(db, 'appointments');
        const apptsQuery = query(apptsCol, orderBy('createdAt', 'desc'));

        onSnapshot(apptsQuery, snapshot => {
            const docs = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));

            // Compute stats
            const uniquePatients = new Set(docs.map(d => d.patientEmail || d.patientName)).size;
            const todayAppts = docs.filter(a => a.date === todayIso);
            const upcoming = docs.filter(a => a.date >= todayIso);

            document.getElementById('stat-total-patients').textContent = uniquePatients;
            document.getElementById('stat-today-appointments').textContent = todayAppts.length;
            document.getElementById('stat-upcoming').textContent = upcoming.length;

            // Render today's list
            const todayList = document.getElementById('today-list');
            todayList.innerHTML = '';
            const sortedToday = todayAppts.slice().sort((a,b) => (a.time||'').localeCompare(b.time||''));
            sortedToday.forEach(a => {
                const div = document.createElement('div');
                div.className = 'appointment-item';
                const patientName = a.patientName || a.patientEmail || 'Unknown';
                const apptType = a.type || 'Consultation';
                const statusClass = a.status === 'confirmed' ? 'status-confirmed' : (a.status === 'pending' ? 'status-pending' : 'status-completed');
                const statusLabel = (a.status || 'pending').charAt(0).toUpperCase() + (a.status||'pending').slice(1);
                div.innerHTML = `
                    <div class="appointment-time">${a.time || ''}</div>
                    <div class="appointment-details">
                        <div class="patient-name">${patientName}</div>
                        <div class="appointment-type">${apptType}</div>
                        <div style="color:#6b7280;font-size:13px">Doctor: ${a.doctorName || '‚Äî'}</div>
                    </div>
                    <div class="appointment-status ${statusClass}">${statusLabel}</div>
                `;
                todayList.appendChild(div);
            });
        }, err => {
            console.error('Failed to listen appointments', err);
        });
    </script>
</body>
</html>


